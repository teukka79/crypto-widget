<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Crypto Glass v54.16 - The Final Masterpiece</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        :root {
            --midnight-blue: hsla(220, 100%, 10%, 0.8);
            --forest-green: hsla(150, 80%, 15%, 0.8);
            --accent-green: rgba(34, 197, 94, 0.4);
            --static-green-text: rgba(74, 222, 128, 0.9);
            --static-red-text: rgba(248, 113, 113, 0.9);
            --mute-red: #ff4d4d;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; margin: 0; padding: 0; background-color: #010409; overflow: hidden; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex; flex-direction: column; align-items: center; color: #e6edf3;
            background-image: 
                radial-gradient(at 0% 0%, var(--midnight-blue) 0%, rgba(0,0,0,0) 70%),
                radial-gradient(at 80% 20%, var(--forest-green) 0%, rgba(0,0,0,0) 70%),
                radial-gradient(at 100% 100%, var(--midnight-blue) 0%, rgba(0,0,0,0) 70%),
                radial-gradient(at 10% 90%, var(--forest-green) 0%, rgba(0,0,0,0) 70%);
            background-attachment: fixed; background-size: cover;
        }

        .glass-alert {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-150%);
            width: 90%; max-width: 380px; padding: 18px 24px; border-radius: 20px;
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            display: flex; align-items: center; gap: 14px; z-index: 10000;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s;
            box-shadow: 0 15px 45px rgba(0,0,0,0.7); border: 1px solid rgba(255,255,255,0.2);
            opacity: 0; cursor: pointer; color: #ffffff; font-weight: 800;
        }
        .glass-alert.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .alert-high { background: rgba(34, 197, 94, 0.4); border-color: rgba(74, 222, 128, 0.5); }
        .alert-low { background: rgba(239, 68, 68, 0.4); border-color: rgba(248, 113, 113, 0.5); }

        .widget {
            position: relative; width: 100%; max-width: 430px; height: 100vh;
            margin: 0 auto; padding: 20px; padding-top: calc(env(safe-area-inset-top) + 25px);
            background: rgba(10, 15, 25, 0.45); backdrop-filter: blur(40px);
            display: flex; flex-direction: column; border-left: 1px solid rgba(255, 255, 255, 0.05);
        }

        .header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .crypto-icon { width: 44px; height: 44px; display: flex; align-items: center; justify-content: center; }
        .crypto-icon img { width: 100%; height: 100%; object-fit: contain; }

        .select-row { display: flex; gap: 8px; margin-bottom: 20px; }
        select { 
            flex: 1; height: 50px; padding: 0 15px; background: rgba(0, 0, 0, 0.4); 
            border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 12px; 
            color: #fff; font-size: 18px; font-weight: 800; outline: none; appearance: none;
        }

        .tf-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .tf-btn { 
            height: 50px; border: none; border-radius: 12px; cursor: pointer; 
            font-weight: 800; font-size: 16px; backdrop-filter: blur(15px); transition: 0.3s; 
            display: flex; align-items: center; justify-content: center;
            background: rgba(255, 255, 255, 0.05); color: rgba(255, 255, 255, 0.4); border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .tf-btn.active { background: var(--accent-green); color: #fff; border: 1px solid rgba(74, 222, 128, 0.4); }

        .price-display { text-align: center; margin-bottom: 25px; }
        .price { font-size: 52px; font-weight: 800; letter-spacing: -2px; }
        .price-change-container { display: inline-flex; align-items: center; gap: 4px; font-size: 16px; font-weight: 800; padding: 6px 14px; border-radius: 10px; margin-top: 10px; backdrop-filter: blur(10px); }

        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat { background: rgba(0, 0, 0, 0.4); padding: 12px; border-radius: 15px; border: 1px solid rgba(255, 255, 255, 0.05); }
        .stat-label { color: rgba(255, 255, 255, 0.4); font-size: 10px; text-transform: uppercase; }
        .stat-value { font-size: 16px; font-weight: 800; color: #fff; margin-top: 6px; }

        .alarm-section { 
            background: rgba(0, 0, 0, 0.4); border-radius: 22px; padding: 20px; 
            border: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 20px;
        }
        .alarm-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .alarm-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .input-box { 
            height: 50px; border-radius: 14px; background: rgba(0, 0, 0, 0.4); 
            border: 1px solid rgba(255, 255, 255, 0.08); color: #fff; 
            text-align: center; font-size: 16px; font-weight: 800; outline: none; width: 100%;
        }

        .btn-static { height: 50px; border: none; border-radius: 12px; cursor: pointer; font-weight: 800; display: flex; align-items: center; justify-content: center; transition: 0.3s; }
        .static-green { background: rgba(34, 197, 94, 0.15); color: var(--static-green-text); }
        .static-red { background: rgba(239, 68, 68, 0.15); color: var(--static-red-text); }

        #speakerIcon { cursor: pointer; transition: 0.3s; font-size: 28px; }
        .mute-off { color: rgba(255, 255, 255, 0.6); font-variation-settings: 'FILL' 0; }
        .mute-on { color: var(--mute-red) !important; font-variation-settings: 'FILL' 1; filter: drop-shadow(0 0 8px rgba(255, 77, 77, 0.4)); }

        .footer { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px; margin-top: auto; padding-bottom: 30px; }
        .live-status-bar { display: flex; align-items: center; gap: 12px; background: rgba(255, 255, 255, 0.03); padding: 10px 20px; border-radius: 25px; border: 1px solid rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); }
        .live-text { font-size: 14px; font-weight: 900; letter-spacing: 2px; color: rgba(255, 255, 255, 0.9); }
        #liveClock { font-size: 16px; font-weight: 800; letter-spacing: 1px; color: #fff; min-width: 80px; text-align: center; }
        
        .pulse-dot { width: 8px; height: 8px; background: #4ade80; border-radius: 50%; position: relative; }
        .pulse-dot::before, .pulse-dot::after { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #4ade80; border-radius: 50%; opacity: 0.6; animation: double-pulse 2s infinite; }
        .pulse-dot::after { animation-delay: 0.6s; }
        @keyframes double-pulse { 0% { transform: scale(1); opacity: 0.6; } 100% { transform: scale(3.5); opacity: 0; } }
        .version-tag { font-size: 9px; text-transform: uppercase; color: rgba(255,255,255,0.2); letter-spacing: 2px; }
        .bell-active { color: #4ade80 !important; animation: bell-swing 2s ease-in-out infinite; transform-origin: top center; }
        @keyframes bell-swing { 0%, 100% { transform: rotate(0); } 15% { transform: rotate(15deg); } 30% { transform: rotate(-10deg); } }
    </style>
</head>
<body>

    <div id="alertBox" class="glass-alert" onclick="this.classList.remove('show')">
        <span id="alertIcon" class="material-symbols-outlined">notifications_active</span>
        <span id="alertText">Target Reached!</span>
    </div>

    <div class="widget">
        <div class="header">
            <div class="crypto-icon"><img id="cryptoIconImg" src=""></div>
            <div>
                <div id="cryptoName" style="font-size:20px; font-weight:800;">...</div>
                <div id="cryptoPair" style="font-size:12px; opacity:0.5;">.../USDT</div>
            </div>
        </div>

        <div class="select-row">
            <select id="cryptoSelect" onchange="changeCrypto()"></select>
            <button class="btn-static static-green" style="width:50px;" onclick="addCrypto()"><span class="material-symbols-outlined">add</span></button>
            <button class="btn-static static-red" style="width:50px;" onclick="removeCrypto()"><span class="material-symbols-outlined">delete</span></button>
        </div>

        <div class="tf-selector">
            <button id="tf1h" class="tf-btn" onclick="setTimeframe('1h')">1H</button>
            <button id="tf24h" class="tf-btn active" onclick="setTimeframe('24h')">24H</button>
        </div>

        <div class="price-display">
            <div class="price" id="price">$0.00</div>
            <div id="priceChangeContainer" class="price-change-container">
                <span id="priceChange">0.00%</span>
            </div>
        </div>

        <div class="stats">
            <div class="stat"><div class="stat-label">High</div><div class="stat-value" id="valHigh">--</div></div>
            <div class="stat"><div class="stat-label">Low</div><div class="stat-value" id="valLow">--</div></div>
            <div class="stat" style="grid-column: span 2;"><div class="stat-label">24h Volume</div><div class="stat-value" id="valVol">--</div></div>
        </div>

        <div class="alarm-section">
            <div class="alarm-header">
                <div style="display:flex; align-items:center; gap:8px;">
                    <span id="bellIcon" class="material-symbols-outlined" style="color: rgba(255,255,255,0.3)">notifications</span>
                    <span style="font-weight:800;">Alerts</span>
                </div>
                <span id="speakerIcon" class="material-symbols-outlined mute-off" onclick="toggleMute()">volume_up</span>
            </div>
            <div class="alarm-grid">
                <input type="number" id="alarmHigh" class="input-box" placeholder="Above">
                <input type="number" id="alarmLow" class="input-box" placeholder="Below">
                <button class="btn-static static-green" onclick="setAlarm()">Set</button>
                <button class="btn-static static-red" onclick="clearAlarm()">Clear</button>
            </div>
        </div>

        <div class="footer">
            <div class="live-status-bar">
                <span class="live-text">LIVE</span>
                <div class="pulse-dot"></div>
                <div id="liveClock">00:00:00</div>
            </div>
            <span class="version-tag">v54.16 Masterpiece</span>
        </div>
    </div>

    <script>
        let ws, currentCrypto = 'btc', isMuted = false, currentTimeframe = '24h';
        let alarms = {}, alertFired = {}, timeframeData = { '1h': '0.00', '24h': '0.00' };
        let hourlyBasePrice = 0;

        const defaultCoins = {
            btc: { name: 'Bitcoin', symbol: 'BTC', pair: 'btcusdt', dec: 2 },
            eth: { name: 'Ethereum', symbol: 'ETH', pair: 'ethusdt', dec: 2 },
            sui: { name: 'Sui', symbol: 'SUI', pair: 'suiusdt', dec: 4 },
            dot: { name: 'Polkadot', symbol: 'DOT', pair: 'dotusdt', dec: 2 },
            atom: { name: 'Cosmos', symbol: 'ATOM', pair: 'atomusdt', dec: 2 },
            sol: { name: 'Solana', symbol: 'SOL', pair: 'solusdt', dec: 2 }
        };
        let config = JSON.parse(JSON.stringify(defaultCoins));

        const audioUp = new Audio('https://raw.githubusercontent.com/teukka79/crypto-widget/main/price_up.mp3');
        const audioDown = new Audio('https://raw.githubusercontent.com/teukka79/crypto-widget/main/price_down.mp3');

        function save() { localStorage.setItem('crypto_glass_v54', JSON.stringify({ config, current: currentCrypto, muted: isMuted, alarms })); }

        async function fetch1hPrice(cKey) {
            try {
                const pair = config[cKey].pair.toUpperCase();
                const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=${pair}&interval=1h&limit=2`);
                const data = await response.json();
                if (data && data.length > 0) {
                    hourlyBasePrice = parseFloat(data[0][1]);
                }
            } catch (e) { console.error("1h fetch error", e); }
        }

        function updateSelectMenu() {
            const sel = document.getElementById('cryptoSelect');
            const currentVal = sel.value || currentCrypto;
            sel.innerHTML = '';
            Object.assign(config, defaultCoins);
            const sortedKeys = Object.keys(config).sort((a, b) => config[a].name.localeCompare(config[b].name));
            sortedKeys.forEach(k => {
                const o = document.createElement('option'); o.value = k; o.text = config[k].name;
                if (k === currentVal) o.selected = true; sel.add(o);
            });
        }

        function toggleMute() {
            isMuted = !isMuted;
            const icon = document.getElementById('speakerIcon');
            icon.innerText = isMuted ? 'volume_off' : 'volume_up';
            icon.className = `material-symbols-outlined ${isMuted ? 'mute-on' : 'mute-off'}`;
            save();
        }

        function connect() {
            if (ws) ws.close();
            const streams = Object.keys(config).map(k => `${config[k].pair}@ticker`).join('/');
            ws = new WebSocket(`wss://stream.binance.com:9443/stream?streams=${streams}`);
            ws.onmessage = (e) => {
                const d = JSON.parse(e.data).data;
                const cKey = Object.keys(config).find(k => config[k].pair === d.s.toLowerCase());
                const price = parseFloat(d.c);
                if (cKey) checkAlarms(cKey, price);
                if (cKey === currentCrypto) {
                    document.getElementById('price').innerText = '$' + price.toLocaleString('en-US', {minimumFractionDigits: config[cKey].dec});
                    timeframeData['24h'] = d.P;
                    if (hourlyBasePrice > 0) {
                        const hChange = ((price - hourlyBasePrice) / hourlyBasePrice) * 100;
                        timeframeData['1h'] = hChange.toFixed(2);
                    }
                    updateChangeDisplay();
                    document.getElementById('valHigh').innerText = '$' + parseFloat(d.h).toLocaleString();
                    document.getElementById('valLow').innerText = '$' + parseFloat(d.l).toLocaleString();
                    document.getElementById('valVol').innerText = parseFloat(d.q).toLocaleString(undefined, {maximumFractionDigits: 0}) + ' USDT';
                }
            };
        }

        function changeCrypto() {
            currentCrypto = document.getElementById('cryptoSelect').value;
            document.getElementById('cryptoName').innerText = config[currentCrypto].name;
            document.getElementById('cryptoPair').innerText = config[currentCrypto].symbol + '/USDT';
            const a = alarms[currentCrypto] || { high: '', low: '' };
            document.getElementById('alarmHigh').value = a.high; document.getElementById('alarmLow').value = a.low;
            updateBell(); updateIcon(currentCrypto); 
            hourlyBasePrice = 0; fetch1hPrice(currentCrypto);
            save();
        }

        function updateIcon(cKey) {
            const sym = config[cKey].symbol.toLowerCase();
            document.getElementById('cryptoIconImg').src = `https://raw.githubusercontent.com/teukka79/crypto-widget/main/${sym}.png`;
        }

        function updateChangeDisplay() {
            const val = timeframeData[currentTimeframe];
            const cont = document.getElementById('priceChangeContainer');
            const pChange = parseFloat(val);
            cont.style.backgroundColor = pChange >= 0 ? 'rgba(34, 197, 94, 0.25)' : 'rgba(239, 68, 68, 0.25)';
            cont.style.color = pChange >= 0 ? '#4ade80' : '#f87171';
            document.getElementById('priceChange').innerText = (pChange >= 0 ? '+' : '') + pChange.toFixed(2) + '%';
            document.getElementById('tf1h').classList.toggle('active', currentTimeframe === '1h');
            document.getElementById('tf24h').classList.toggle('active', currentTimeframe === '24h');
        }

        function checkAlarms(cKey, price) {
            const a = alarms[cKey]; if (!a) return;
            const h = parseFloat(a.high), l = parseFloat(a.low);
            if (h && price >= h && !alertFired[cKey + '_high']) { 
                if(!isMuted) audioUp.play().catch(()=>{});
                showGlassAlert(`${config[cKey].symbol} TARGET: $${price.toLocaleString()}`, 'high');
                alertFired[cKey + '_high'] = true; 
            } else if (h && price < h) { alertFired[cKey + '_high'] = false; }
            if (l && price <= l && !alertFired[cKey + '_low']) { 
                if(!isMuted) audioDown.play().catch(()=>{});
                showGlassAlert(`${config[cKey].symbol} TARGET: $${price.toLocaleString()}`, 'low');
                alertFired[cKey + '_low'] = true; 
            } else if (l && price > l) { alertFired[cKey + '_low'] = false; }
        }

        function showGlassAlert(msg, type) {
            const box = document.getElementById('alertBox');
            box.className = `glass-alert show alert-${type}`;
            document.getElementById('alertText').innerText = msg;
            setTimeout(() => box.classList.remove('show'), 6000);
        }

        function setTimeframe(tf) { currentTimeframe = tf; updateChangeDisplay(); }
        function setAlarm() { alarms[currentCrypto] = { high: document.getElementById('alarmHigh').value, low: document.getElementById('alarmLow').value }; save(); updateBell(); }
        function clearAlarm() { document.getElementById('alarmHigh').value = ''; document.getElementById('alarmLow').value = ''; alarms[currentCrypto] = { high: '', low: '' }; save(); updateBell(); }
        function updateBell() { const a = alarms[currentCrypto] || { high: '', low: '' }; document.getElementById('bellIcon').className = 'material-symbols-outlined ' + ((a.high || a.low) ? 'bell-active' : ''); }
        function updateClock() { document.getElementById('liveClock').innerText = new Date().toLocaleTimeString('en-GB', { hour12: false }); }
        
        function addCrypto() {
            const sym = prompt("Enter Symbol (e.g. bnb, xrp):");
            if (!sym) return;
            const s = sym.toLowerCase().trim();
            if (config[s]) return alert("Exists!");
            config[s] = { name: s.toUpperCase(), symbol: s.toUpperCase(), pair: s + 'usdt', dec: 2 };
            save(); updateSelectMenu(); changeCrypto(); connect();
        }

        function removeCrypto() {
            if (defaultCoins[currentCrypto]) return alert("Cannot remove core currencies!");
            if (confirm(`Remove ${config[currentCrypto].name}?`)) {
                delete config[currentCrypto]; delete alarms[currentCrypto];
                save(); location.reload();
            }
        }

        setInterval(updateClock, 1000); updateClock();

        window.onload = () => {
            const saved = JSON.parse(localStorage.getItem('crypto_glass_v54'));
            if (saved) { config = saved.config || config; currentCrypto = saved.current || 'btc'; isMuted = saved.muted || false; alarms = saved.alarms || {}; }
            updateSelectMenu();
            const icon = document.getElementById('speakerIcon');
            if (isMuted) { icon.innerText = 'volume_off'; icon.className = 'material-symbols-outlined mute-on'; }
            connect(); changeCrypto();
        };
    </script>
</body>
</html>
