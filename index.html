<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Crypto Glass v55.8.5 - Final Masterpiece</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        :root {
            --midnight-blue: hsla(220, 100%, 10%, 0.85);
            --forest-green: hsla(150, 80%, 15%, 0.7);
            --static-green-text: #4ade80;
            --static-red-text: #f87171;
            --glass-border: rgba(255, 255, 255, 0.06); 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        html, body { height: 100%; margin: 0; padding: 0; background-color: #010409; overflow: hidden; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex; flex-direction: column; align-items: center; color: #e6edf3;
            background-image: 
                radial-gradient(at 0% 0%, var(--midnight-blue) 0%, rgba(0,0,0,0) 70%),
                radial-gradient(at 80% 20%, var(--forest-green) 0%, rgba(0,0,0,0) 70%),
                radial-gradient(at 100% 100%, var(--midnight-blue) 0%, rgba(0,0,0,0) 70%),
                radial-gradient(at 10% 90%, var(--forest-green) 0%, rgba(0,0,0,0) 70%);
            background-attachment: fixed; background-size: cover;
        }

        input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        input:focus, select:focus, button:focus { outline: none; border: 1px solid rgba(255,255,255,0.15) !important; }

        /* --- ANIMAATIOT --- */
        @keyframes reveal-slide {
            0% { clip-path: inset(0 100% 0 0); transform: translateX(-20px); opacity: 0; }
            100% { clip-path: inset(0 0 0 0); transform: translateX(0); opacity: 1; }
        }
        @keyframes soft-text-glow {
            0%, 100% { text-shadow: 0 0 8px rgba(74, 222, 128, 0.4); }
            50% { text-shadow: 0 0 20px rgba(74, 222, 128, 1), 0 0 2px #fff; }
        }
        @keyframes white-glow {
            0%, 100% { text-shadow: 0 0 10px rgba(255, 255, 255, 0.6); }
            50% { text-shadow: 0 0 20px rgba(255, 255, 255, 1), 0 0 5px rgba(255, 255, 255, 0.8); }
        }
        @keyframes bell-swing {
            0% { transform: rotate(0); }
            20% { transform: rotate(18deg); }
            40% { transform: rotate(-18deg); }
            60% { transform: rotate(12deg); }
            80% { transform: rotate(-12deg); }
            100% { transform: rotate(0); }
        }
        .swinging { animation: bell-swing 0.6s ease-in-out infinite !important; }

        /* --- HÃ„LYTYSIKKUNA --- */
        .glass-alert {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-150%);
            width: 88%; max-width: 350px; padding: 18px 22px; border-radius: 20px;
            backdrop-filter: blur(35px); -webkit-backdrop-filter: blur(35px);
            display: flex; align-items: center; gap: 14px; z-index: 12000;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s;
            box-shadow: 0 20px 50px rgba(0,0,0,0.6); 
            border: 1px solid rgba(255,255,255,0.15);
            opacity: 0; color: #ffffff; font-weight: 900; 
            background: rgba(34, 197, 94, 0.4);
        }
        .glass-alert.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .glass-alert.show #alertText { 
            display: inline-block;
            animation: reveal-slide 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards, soft-text-glow 1.5s infinite ease-in-out 0.8s;
        }
        #alertIcon { color: #ffffff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.6); }
        #alertIcon.swinging { animation: bell-swing 0.6s ease-in-out infinite, white-glow 1.5s infinite ease-in-out; }

        /* --- WIDGET --- */
        .widget {
            position: relative; width: 100%; max-width: 390px; height: 100vh;
            margin: 0 auto; padding: 15px; padding-top: calc(env(safe-area-inset-top) + 20px);
            background: rgba(10, 15, 25, 0.45); backdrop-filter: blur(40px);
            display: flex; flex-direction: column; overflow-x: hidden;
            border-left: 1px solid var(--glass-border); border-right: 1px solid var(--glass-border);
        }

        .header { display: flex; align-items: center; gap: 12px; margin-bottom: 15px; }
        .crypto-icon { width: 42px; height: 42px; display: flex; align-items: center; justify-content: center; }
        .crypto-icon img { width: 100%; height: 100%; object-fit: contain; }
        #cryptoName { font-weight: 900; font-size: 22px; }
        #cryptoPair { font-size: 12px; opacity: 0.6; font-weight: 600; }

        .select-row { display: flex; gap: 8px; margin-bottom: 15px; }
        select { flex: 1; height: 48px; padding: 0 12px; background: rgba(0, 0, 0, 0.4); border: 1px solid var(--glass-border); border-radius: 12px; color: #fff; font-size: 15px; font-weight: 800; appearance: none; }

        .tf-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .tf-btn { height: 48px; border: none; border-radius: 12px; cursor: pointer; font-weight: 800; background: rgba(255, 255, 255, 0.05); color: rgba(255, 255, 255, 0.4); }
        .tf-btn.active { background: rgba(34, 197, 94, 0.4); color: #fff; }

        .price-display { text-align: center; margin-bottom: 15px; }
        .price { font-size: 38px; font-weight: 800; letter-spacing: -1px; }

        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .stat { background: rgba(0, 0, 0, 0.4); padding: 10px; border-radius: 14px; border: 1px solid var(--glass-border); }

        .alarm-section { background: rgba(0, 0, 0, 0.4); border-radius: 20px; padding: 15px; border: 1px solid var(--glass-border); margin-bottom: 15px; }
        .alarm-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 10px; }
        .alarm-grid input { height: 48px; border-radius: 12px; background: rgba(0,0,0,0.4); border: 1px solid var(--glass-border); color: #fff; text-align: center; font-weight: 800; width: 100%; font-size: 14px; }

        .btn-static { height: 48px; border: none; border-radius: 12px; cursor: pointer; font-weight: 800; display: flex; align-items: center; justify-content: center; width: 100%; font-size: 14px; }
        .static-green { background: rgba(34, 197, 94, 0.15); color: var(--static-green-text); }
        .static-red { background: rgba(239, 68, 68, 0.15); color: var(--static-red-text); }

        .glass-btn-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.05); border: none; cursor: pointer; }
        #muteBtn.live { color: var(--static-green-text); }
        #muteBtn.muted { color: var(--static-red-text); }
        #widgetBell.swinging { color: var(--static-green-text) !important; }

        .footer { display: flex; justify-content: center; margin-top: auto; padding-bottom: 25px; }
        .live-status-bar { display: flex; align-items: center; gap: 10px; background: rgba(255, 255, 255, 0.03); padding: 8px 16px; border-radius: 20px; border: 1px solid rgba(255, 255, 255, 0.05); }
    </style>
</head>
<body>
    <div id="modalOverlay" style="position:fixed; inset:0; background:rgba(0,0,0,0.85); backdrop-filter:blur(15px); display:none; align-items:center; justify-content:center; z-index:11000;"><div id="modalContainer" style="background:#0d1117; padding:25px; border-radius:24px; width:320px; text-align:center; border:1px solid var(--glass-border);"></div></div>
    
    <div id="alertBox" class="glass-alert" onclick="this.classList.remove('show')">
        <span class="material-symbols-outlined" id="alertIcon">notifications</span>
        <span id="alertText">ALERT!</span>
    </div>

    <div class="widget">
        <div class="header">
            <div class="crypto-icon"><img id="cryptoIconImg" src=""></div>
            <div>
                <div id="cryptoName">BTC</div>
                <div id="cryptoPair">BTC/USDT</div>
            </div>
        </div>

        <div class="select-row">
            <select id="cryptoSelect" onchange="handleSelectChange()"></select>
            <button class="glass-btn-icon" style="color:var(--static-green-text);" onclick="openAddModal()"><span class="material-symbols-outlined">add</span></button>
            <button class="glass-btn-icon" style="color:var(--static-red-text);" onclick="confirmRemove()"><span class="material-symbols-outlined">delete</span></button>
        </div>

        <div class="tf-selector">
            <button id="tf1h" class="tf-btn" onclick="setTimeframe('1h')">1H</button>
            <button id="tf24h" class="tf-btn active" onclick="setTimeframe('24h')">24H</button>
        </div>

        <div class="price-display">
            <div class="price" id="price">$0.00</div>
            <div id="priceChangeContainer" style="display:inline-flex; align-items:center; gap:4px; font-size:14px; font-weight:800; padding:6px 12px; border-radius:10px; margin-top:8px;"><span id="priceChange">+0.00%</span></div>
        </div>

        <div class="stats">
            <div class="stat"><div style="color:rgba(255,255,255,0.5); font-size:10px; font-weight:700;">HIGH</div><div id="valHigh" style="font-size:13px; font-weight:800; margin-top:4px;">--</div></div>
            <div class="stat"><div style="color:rgba(255,255,255,0.5); font-size:10px; font-weight:700;">LOW</div><div id="valLow" style="font-size:13px; font-weight:800; margin-top:4px;">--</div></div>
            <div class="stat" style="grid-column: span 2;"><div id="volLabel" style="color:rgba(255,255,255,0.5); font-size:10px; font-weight:700;">24H VOLUME</div><div id="valVol" style="font-size:13px; font-weight:800; margin-top:4px;">--</div></div>
        </div>

        <div class="alarm-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                <div style="display:flex; align-items:center; gap:10px;">
                    <div class="glass-btn-icon" style="width:40px; height:40px;"><span class="material-symbols-outlined" id="widgetBell">notifications</span></div>
                    <span style="font-weight:800; font-size:16px;">Alerts</span>
                </div>
                <button id="muteBtn" class="glass-btn-icon live" onclick="toggleMute()" style="width:40px; height:40px;"><span class="material-symbols-outlined" id="muteIcon">volume_up</span></button>
            </div>
            <div class="alarm-grid">
                <input type="number" id="alarmHigh" placeholder="Above" step="any">
                <input type="number" id="alarmLow" placeholder="Below" step="any">
                <button class="btn-static static-green" onclick="setAlarm()">Set</button>
                <button class="btn-static static-red" onclick="clearAlarm()">Clear</button>
            </div>
        </div>

        <div class="footer">
            <div class="live-status-bar">
                <div style="width:8px; height:8px; background:#4ade80; border-radius:50%;"></div>
                <div id="liveClock" style="font-weight:800; font-size:14px;">00:00:00</div>
            </div>
        </div>
    </div>

    <script>
        let ws, currentCrypto = 'btc', currentTimeframe = '24h', alarms = {}, timeframeData = {'1h':'0.00','24h':'0.00'}, isMuted = false, hourlyBasePrice = 0;
        let lastAudioTime = 0, currentLiveVol = "--", hourlyVolume = "--", alertStates = {}; 

        let config = { btc: { name: 'Bitcoin', symbol: 'BTC', pair: 'btcusdt', source: 'binance' } };
        const audioUp = new Audio('https://raw.githubusercontent.com/teukka79/crypto-widget/main/price_up.mp3');

        function handleSelectChange() { currentCrypto = document.getElementById('cryptoSelect').value; changeCrypto(); save(); }
        function toggleMute() { isMuted = !isMuted; const mb = document.getElementById('muteBtn'); const mi = document.getElementById('muteIcon'); mb.className = `glass-btn-icon ${isMuted ? 'muted' : 'live'}`; mi.innerText = isMuted ? 'volume_off' : 'volume_up'; save(); }

        function changeCrypto() {
            const coin = config[currentCrypto];
            document.getElementById('cryptoIconImg').src = `https://raw.githubusercontent.com/teukka79/crypto-widget/main/${coin.symbol.toLowerCase()}.png`;
            document.getElementById('cryptoName').innerText = coin.symbol;
            document.getElementById('cryptoPair').innerText = coin.symbol + '/USDT';
            document.getElementById('alarmHigh').value = (alarms[currentCrypto] || {}).high || '';
            document.getElementById('alarmLow').value = (alarms[currentCrypto] || {}).low || '';
            connect(); fetch1hData(currentCrypto);
        }

        function connect() {
            if (ws) ws.close();
            const coin = config[currentCrypto];
            if (coin.source === 'gate' || coin.symbol === "REEF") {
                ws = new WebSocket("wss://api.gateio.ws/ws/v4/");
                ws.onopen = () => ws.send(JSON.stringify({channel:"spot.tickers", event:"subscribe", payload:[coin.symbol+"_USDT"]}));
                ws.onmessage = (e) => { const r = JSON.parse(e.data); if (r.event === "update") handleTickerData(r.result.last, r.result.change_percentage, r.result.high_24h, r.result.low_24h, r.result.quote_volume); };
            } else {
                ws = new WebSocket(`wss://stream.binance.com:9443/ws/${coin.pair}@ticker`);
                ws.onmessage = (e) => { const d = JSON.parse(e.data); handleTickerData(d.c, d.P, d.h, d.l, d.q); };
            }
        }

        function handleTickerData(price, change, high, low, vol) {
            const p = parseFloat(price); const decimals = (config[currentCrypto].symbol === "REEF") ? 8 : (p < 10 ? 4 : 2);
            document.getElementById('price').innerText = '$' + p.toLocaleString(undefined, {minimumFractionDigits: decimals, maximumFractionDigits: decimals});
            timeframeData['24h'] = change;
            if (hourlyBasePrice > 0) timeframeData['1h'] = (((p - hourlyBasePrice) / hourlyBasePrice) * 100).toFixed(2);
            updateChangeDisplay();
            document.getElementById('valHigh').innerText = '$' + parseFloat(high).toLocaleString(undefined, {maximumFractionDigits: decimals});
            document.getElementById('valLow').innerText = '$' + parseFloat(low).toLocaleString(undefined, {maximumFractionDigits: decimals});
            currentLiveVol = parseFloat(vol).toLocaleString(undefined, {maximumFractionDigits: 0}) + ' USDT';
            updateVolDisplay(); checkAlarms(p);
        }

        function checkAlarms(p) {
            const a = alarms[currentCrypto]; if (!a) return;
            const now = Date.now(); const cKey = currentCrypto;
            if (!alertStates[cKey]) alertStates[cKey] = { h: false, l: false };
            let hit = false;
            if (a.high && p >= a.high) { if (!alertStates[cKey].h) { hit = true; alertStates[cKey].h = true; } } else { alertStates[cKey].h = false; }
            if (a.low && p <= a.low) { if (!alertStates[cKey].l) { hit = true; alertStates[cKey].l = true; } } else { alertStates[cKey].l = false; }
            
            if (hit && !isMuted && (now - lastAudioTime > 30000)) {
                audioUp.play(); lastAudioTime = now;
                showGlassAlert(`${config[cKey].symbol} TARGET!`, true);
                const wb = document.getElementById('widgetBell');
                wb.classList.add('swinging');
                setTimeout(() => wb.classList.remove('swinging'), 10000);
            }
        }

        function setAlarm() { 
            alarms[currentCrypto] = { high: document.getElementById('alarmHigh').value, low: document.getElementById('alarmLow').value }; 
            alertStates[currentCrypto] = { h: false, l: false }; 
            save(); 
            showGlassAlert("ALARM SET!", false); 
            const wb = document.getElementById('widgetBell');
            wb.classList.add('swinging');
            setTimeout(() => wb.classList.remove('swinging'), 600);
        }

        function showGlassAlert(msg, isTarget) {
            const box = document.getElementById('alertBox');
            const icon = document.getElementById('alertIcon');
            const txt = document.getElementById('alertText');
            txt.innerText = msg;
            icon.innerText = isTarget ? "notifications_active" : "notifications";
            if (isTarget) icon.classList.add('swinging');
            box.classList.add('show');
            setTimeout(() => {
                box.classList.remove('show');
                setTimeout(() => icon.classList.remove('swinging'), 600);
            }, 5000);
        }

        async function fetch1hData(cKey) {
            const coin = config[cKey];
            try {
                if (coin.source === 'binance' && coin.symbol !== "REEF") {
                    const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${coin.pair.toUpperCase()}&interval=1h&limit=1`);
                    const d = await res.json(); hourlyBasePrice = parseFloat(d[0][1]);
                    hourlyVolume = (parseFloat(d[0][5]) * hourlyBasePrice).toLocaleString(undefined, {maximumFractionDigits: 0}) + ' USDT';
                } else {
                    const res = await fetch(`https://api.gateio.ws/api/v4/spot/candlesticks?currency_pair=${coin.symbol}_USDT&interval=1h&limit=1`);
                    const d = await res.json(); hourlyBasePrice = parseFloat(d[0][5]);
                    hourlyVolume = parseFloat(d[0][1]).toLocaleString(undefined, {maximumFractionDigits: 0}) + ' USDT';
                }
                updateVolDisplay();
            } catch(e) {}
        }

        function updateChangeDisplay() {
            const val = parseFloat(timeframeData[currentTimeframe]); const cont = document.getElementById('priceChangeContainer');
            cont.style.color = val >= 0 ? 'var(--static-green-text)' : 'var(--static-red-text)';
            cont.style.backgroundColor = val >= 0 ? 'rgba(34,197,94,0.2)' : 'rgba(239,68,68,0.2)';
            document.getElementById('priceChange').innerText = (val >= 0 ? '+' : '') + val.toFixed(2) + '%';
        }

        function updateVolDisplay() {
            document.getElementById('volLabel').innerText = currentTimeframe === '1h' ? "1H VOLUME" : "24H VOLUME";
            document.getElementById('valVol').innerText = currentTimeframe === '1h' ? hourlyVolume : currentLiveVol;
        }

        function setTimeframe(tf) { currentTimeframe = tf; document.getElementById('tf1h').classList.toggle('active', tf==='1h'); document.getElementById('tf24h').classList.toggle('active', tf==='24h'); updateChangeDisplay(); updateVolDisplay(); }
        function save() { localStorage.setItem('crypto_glass_v55', JSON.stringify({ config, current: currentCrypto, alarms, isMuted })); }
        function clearAlarm() { document.getElementById('alarmHigh').value = ''; document.getElementById('alarmLow').value = ''; delete alarms[currentCrypto]; save(); }

        function openAddModal() {
            document.getElementById('modalOverlay').style.display = 'flex';
            document.getElementById('modalContainer').innerHTML = `<h3>Add Token</h3><input type="text" id="modalInput" style="width:100%; height:48px; background:rgba(255,255,255,0.05); color:#fff; text-align:center; border:1px solid var(--glass-border); border-radius:12px; margin-bottom:15px;" placeholder="Symbol"><div style="display:flex; gap:10px;"><button class="btn-static static-green" onclick="confirmAdd()">Add</button><button class="btn-static static-red" onclick="closeModal()">Back</button></div>`;
        }

        function confirmAdd() {
            const sym = document.getElementById('modalInput').value.toUpperCase().trim(); if(!sym) return;
            const src = (sym === "REEF") ? 'gate' : 'binance';
            config[sym.toLowerCase()] = { name: sym, symbol: sym, pair: (src==='binance' ? sym.toLowerCase()+'usdt' : sym.toLowerCase()+'_usdt'), source: src };
            currentCrypto = sym.toLowerCase(); updateSelectMenu(); closeModal(); changeCrypto(); save();
        }

        function updateSelectMenu() {
            const sel = document.getElementById('cryptoSelect'); sel.innerHTML = '';
            Object.keys(config).sort().forEach(k => {
                const o = document.createElement('option'); o.value = k;
                o.text = `${config[k].symbol} (${config[k].source === 'binance' ? 'Binance' : 'Gate.io'})`;
                if(k === currentCrypto) o.selected = true; sel.add(o);
            });
        }

        function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }
        function confirmRemove() { const name = config[currentCrypto].symbol; document.getElementById('modalOverlay').style.display = 'flex'; document.getElementById('modalContainer').innerHTML = `<h3>Remove ${name}?</h3><div style="display:flex; gap:10px; margin-top:20px;"><button class="btn-static static-red" onclick="executeRemove()">Delete</button><button class="btn-static static-green" onclick="closeModal()">Keep</button></div>`; }
        function executeRemove() { delete config[currentCrypto]; const rem = Object.keys(config); currentCrypto = rem.length > 0 ? rem[0] : 'btc'; save(); location.reload(); }

        setInterval(() => { document.getElementById('liveClock').innerText = new Date().toLocaleTimeString('en-GB', { hour12: false }); }, 1000);
        
        window.onload = () => {
            const saved = JSON.parse(localStorage.getItem('crypto_glass_v55'));
            if (saved) { config = saved.config || config; currentCrypto = saved.current || 'btc'; alarms = saved.alarms || {}; isMuted = saved.isMuted || false; }
            updateSelectMenu(); changeCrypto();
            const mb = document.getElementById('muteBtn'); const mi = document.getElementById('muteIcon');
            mb.className = `glass-btn-icon ${isMuted ? 'muted' : 'live'}`; mi.innerText = isMuted ? 'volume_off' : 'volume_up';
        };
    </script>
</body>
</html>
